<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title></title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="css/styles.css"/>
        <script>

            // HTML tags
            let timerContainer = undefined;
            let startTimerButton = undefined;
            let resetTimerButton = undefined;
            let skipSessionButton = undefined;
            let statsButton = undefined;
            let settingsButton = undefined;
            let promodoroTag = undefined;
            let modalTitleTag = undefined;

            let minutes = 0;
            let seconds = 0;
            let currentTime = "";
            let running = false;
            let sessionTitle = "";
            let timer = undefined;

            let workTime = 25;
            let shortBreak = 5
            let longBreak = 15;
            let promodoro = 0

            const states = {
                Work: "Work",
                ShortBreak: "ShortBreak",
                LongBreak: "LongBreak"
            };

            let currentState = states.Work;
            
            document.addEventListener("DOMContentLoaded",() => {
                timerContainer = document.querySelector(".timer");
                startTimerButton = document.querySelector("#start-timer-button");
                resetTimerButton = document.querySelector("#reset-timer-button");
                skipSessionButton = document.querySelector("#skip-session");
                statsButton = document.querySelector("#stats-button");
                settingsButton = document.querySelector("#settings-button");

                sessionTitle = document.querySelector(".session-title");
                promodoroTag = document.querySelector(".promodoro-count");
                modalTitleTag = document.querySelector(".modal-title");

                sessionTitle.innerHTML = "Work";
                promodoroTag.innerHTML = promodoro;

                minutes = workTime;
                seconds = 0;
                if (seconds < 10) { seconds = "0"+seconds; }
                currentTime = minutes + ":" + seconds;
                timerContainer.innerHTML = currentTime;

                statsButton.addEventListener("click", () => { 
                    modalTitleTag.innerHTML = "Statistics";
                });

                settingsButton.addEventListener("click", () => {
                    modalTitleTag.innerHTML = "Settings";
                });

                startTimerButton.addEventListener("click", () => {
                    running = !running;
                    if (running) {
                        startTimerButton.innerHTML = "Stop";
                        resetTimerButton.disabled = true;
                        skipSessionButton.disabled = true;
                        startTimer();
                    } else {
                        startTimerButton.innerHTML = "Start";
                        resetTimerButton.disabled = false;
                        skipSessionButton.disabled = false;
                        stopTimer();
                    }
                });

                resetTimerButton.addEventListener("click", resetTimer);
                skipSessionButton.addEventListener("click", skipSession);
            });

            function skipSession() {
                minutes = 0;
                seconds = 0;
                seconds = "0"+seconds;
                finishSession(true);
            }

            function finishSession(wasSkipped = false) {
                running = false;
                skipSessionButton.disabled = false;
                if (currentState == states.Work) {
                    if (!wasSkipped) {
                        promodoro += 1;
                    }
                    setupForBreak();
                } else {
                    setupForWork();
                }

                startTimerButton.innerHTML = "Start";
                promodoroTag.innerHTML = promodoro;
                clearInterval(timer);
                setupTimer();
            }

            function setupForBreak() {
                if (promodoro % 4 == 0 && promodoro != 0) {
                    currentState = states.LongBreak;
                } else {
                    currentState = states.ShortBreak;
                }
                sessionTitle.innerHTML = "Break";
            }

            function setupForWork() {
                currentState = states.Work;
                sessionTitle.innerHTML = "Work";
            }

            function setupTimer() {
                if (currentState == states.LongBreak) {
                    minutes = longBreak;
                } else if (currentState == states.ShortBreak) {
                    minutes = shortBreak;
                } else {
                    minutes = workTime;
                }

                currentTime = minutes + ":" + seconds;
                timerContainer.innerHTML = currentTime;
            }

            function updateTimer()
            {
                if (minutes == 0 && seconds == 0) {
                    finishSession();
                    return;
                }
                if (seconds == 0) {
                    minutes -= 1;
                    seconds = 59;
                } else {
                    seconds -= 1;
                }
                if (Number(seconds) < 10) { seconds = "0" + String(seconds); }
                let currentTime = minutes + ":" + seconds;
                timerContainer.innerHTML = currentTime;
            }

            function startTimer() {
                timer = setInterval(updateTimer, 10);
            }

            function stopTimer() {
                clearInterval(timer);
                if (minutes == 0 && seconds == 0) {
                    resetTimer();
                }
            }

            function resetTimer() {
                if (running) { return; }
                setupForWork();
                minutes = workTime;
                seconds = 0;
                promodoro = 0;
                if (seconds < 10) { seconds = "0"+seconds; }
                currentTime = minutes + ":" + seconds;
                timerContainer.innerHTML = currentTime;
                promodoroTag.innerHTML = promodoro;
            }
        </script>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">Promodoro</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <button id="stats-button" class="nav-item btn btn-secondary nav-button" data-bs-toggle="modal" data-bs-target="#exampleModal">Stats</button>
                  <button id="settings-button" class="nav-item btn btn-secondary nav-button" data-bs-toggle="modal" data-bs-target="#exampleModal">Settings</button>
                </ul>
              </div>
            </div>
        </nav>
        <section class="container text-center timer-section">
            <h3 class="session-title display-6">session title</h3>
            <div class="timer">
            </div>
            <button id="start-timer-button" class="btn btn-secondary">Start</button>
            <button id="reset-timer-button" class="btn btn-secondary">Reset</button>
            <button id="skip-session" class="btn btn-secondary">Skip</button>
            <hr/>
            <h2>Promodoro:<span class="promodoro-count"></span></h2>
        </section>
       
  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Some Title</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
        </div>
        </div>
    </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    </body>
</html>